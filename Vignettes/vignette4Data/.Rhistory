knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
# Load data and change concentration to numeric
data1 <- read.csv("~/Dropbox (OMRF)/Github/CRISPRScreenAnalysis/Vignettes/vignette4Data/Proliferation(OutliersRemoved).csv" , header = T)
data1$Concentration <- gsub("uM", "", data1$Concentration) %>% as.numeric()
library(tidyverse)
data1$Concentration <- gsub("uM", "", data1$Concentration) %>% as.numeric()
# Normalize the cell #s
normalize.df <- data1 %>%
split(f=.$Sample) %>%
lapply(.,function(df){
df$median <- median(df$Cells[which(df$Concentration==0)])
df$normalized <- df$Cells/df$median
df}) %>%
do.call("rbind",.)
# strip plot with normalized cell numbers and median values plotted
stripPlot <- ggplot(normalize.df, aes(x=Sample, y=normalized, color=as.character(Concentration))) +
geom_jitter(height = 0, width = 0.15) +
xlab("Sample") +
ylab("Normalized Cell Counts") +
ggtitle("Normalized Cell Counts by Sample (Mean of each group shown)") +
labs(colour="Concentration")
stripPlot + stat_summary(fun.y=median, geom="point", shape=13, size=8, color="black") + theme_classic()
ggplot(normalize.df, aes(x=Sample, y=normalized, color=Sample)) +
geom_jitter(height = 0, width = 0.15) +
xlab("Concentration") +
ylab("log(Normalized Cell Counts)") +
ggtitle("Normalized Cell Counts by Concentration and Sample") +
labs(colour="Sample") +
facet_wrap(~Concentration) +
theme_classic()
normalize.df %>%
mutate(Sample = fct_relevel(Sample,
"CDC45UI", "NT_Control", "ADAM2",
"SETX", "UNC5C")) %>%
ggplot(aes(x=Sample, y=normalized, color=Sample)) +
geom_jitter(height = 0, width = 0.15) +
xlab("Concentration") +
ylab("log(Normalized Cell Counts)") +
ggtitle("Normalized Cell Counts by Concentration and Sample") +
labs(colour="Sample") +
facet_wrap(~Concentration) +
theme_classic()
head(normalize.df)
normalize.df
normalize.df
normalize.df %>%
mutate(Sample = fct_relevel(Sample,
"CDC45UI", "NT_Control", "ADAM2",
"SETX", "UNC5C")) %>%
filter(Sample == "ADAM2" | Sample == "CDC45UI" | Sample == "NT_Control" |
Sample == "SETX" | Sample == "UNC5C") %>%
ggplot(aes(x=Sample, y=normalized, color=Sample)) +
geom_jitter(height = 0, width = 0.15) +
xlab("Concentration") +
ylab("log(Normalized Cell Counts)") +
ggtitle("Normalized Cell Counts by Concentration and Sample") +
labs(colour="Sample") +
facet_wrap(~Concentration) +
theme_classic()
normalize.df %>%
mutate(Sample = fct_relevel(Sample,
"CDC45UI", "NT_Control", "ADAM2",
"SETX", "UNC5C")) %>%
filter(Sample == "ADAM2" | Sample == "CDC45UI" | Sample == "NT_Control" |
Sample == "SETX" | Sample == "UNC5C") %>%
ggplot(aes(x=Sample, y=normalized, color=Sample)) +
geom_jitter(height = 0, width = 0.15) +
xlab("Concentration") +
ylab("log(Normalized Cell Counts)") +
ggtitle("Normalized Cell Counts by Concentration and Sample") +
labs(colour="Sample") +
facet_wrap(~Concentration) +
theme_classic()
normalize.df %>%
mutate(Sample = fct_relevel(Sample,
"CDC45UI", "NT_Control", "ADAM2",
"SETX", "UNC5C")) %>%
filter(Sample == "ADAM2" | Sample == "CDC45UI" | Sample == "NT_Control" |
Sample == "SETX" | Sample == "UNC5C") %>%
ggplot(aes(x=Sample, y=normalized, color=Sample)) +
geom_jitter(height = 0, width = 0.15) +
xlab("Concentration") +
ylab("log(Normalized Cell Counts)") +
ggtitle("Normalized Cell Counts by Concentration and Sample") +
labs(colour="Sample") +
facet_wrap(~Concentration) +
theme_classic()
library(MAGeCKFlute)
library(plotly)
library(RColorBrewer)
library(htmlwidgets)
library(cowplot)
library(tidyverse)
library(ggrepel)
Replicates <- read.table("~/Dropbox (OMRF)/2021Oct12_All_CRISPR_Screens/Sansam/AllScreens/MLE/2022March23_All_CDC45_Day9.gene_summary.txt" , header = T)
head(Replicates)
gdata <- ReadBeta(Replicates)
head(gdata)
ctrlname = "NoAuxin"
treatname = "Auxin"
gdata_cc = NormalizeBeta(gdata, samples=c(ctrlname, treatname), method="cell_cycle")
head(gdata_cc)
gdata_loe = NormalizeBeta(gdata, samples=c(ctrlname, treatname), method="loess")
head(gdata_loe)
#to compare density of the non-normalized betas
p1 <- DensityView(gdata, samples=c(ctrlname, treatname))
#to compare density of the normalized betas
p2 <- DensityView(gdata_cc, samples=c(ctrlname, treatname))
#to compare density of the normalized betas
p3 <- DensityView(gdata_loe, samples=c(ctrlname, treatname))
#plot them side by side
plot_grid(p1, p2, p3, labels = c("NonNormalized","CellCycle","Loess"), nrow = 1)
# choose which normalization
gdata1 <- gdata
gdata1$AuxinFDR <- Replicates$Auxin.fdr
gdata1$NoAuxinFDR <- Replicates$NoAuxin.fdr
#positive and negative selection
gdata1$NoAuxin = rowMeans(gdata1[,ctrlname, drop = FALSE])
gdata1$Auxin = rowMeans(gdata1[,treatname, drop = FALSE])
#make difference column (Treatment - Control)
gdata1$diff <- gdata1$Auxin - gdata1$NoAuxin
#ggplot with nice labels and color scheme
p1 <- ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient(low = "#ff7f00", high = "#7570b3")
p1
#ggplot with nice labels and color scheme
p2 <- ggplot(data=Replicates,aes(x=NoAuxin.beta,y=Auxin.beta,label=Gene,color=Auxin.fdr))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with Rep2_vs_Rep1 FDR") +
scale_colour_gradient(low = "#ff7f00", high = "#7570b3") #+
#  scale_x_continuous(limits = c(-3, 2.5)) +
#  scale_y_continuous(limits = c(-3, 2.5))
p2
#ggplot with nice labels and color scheme
p3 <- ggplot(data=Replicates,aes(x=NoAuxin.beta,y=Auxin.beta,label=Gene,color=Auxin.p.value))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with Rep1_vs_Rep2 Pvalue") +
scale_colour_gradient(low = "#ff7f00", high = "#7570b3")
p3
#ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, NoAuxinFDR<=0.1), aes(label=Gene), max.overlaps = 60)
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
#
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, NoAuxinFDR<=0.1), aes(label=Gene), max.overlaps = 60)
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
# All text even overlapped
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text(data = subset(gdata1, AuxinFDR <= 0.1), aes(x=NoAuxin,y=Auxin, label=Gene))
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
# All text even overlapped
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text(data = subset(gdata1, AuxinFDR <= 0.1), aes(x=NoAuxin,y=Auxin, label=Gene))
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text(data = subset(gdata1, NoAuxinFDR <= 0.1), aes(x=NoAuxin,y=Auxin, label=Gene))
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff))+
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text(data = subset(gdata1, NoAuxinFDR <= 0.1), aes(x=NoAuxin,y=Auxin, label=Gene))
AuxinFDR <- gdata1 %>% filter(AuxinFDR <= 0.1)
AuxinFDR
NoAuxinFDR <- gdata1 %>% filter(NoAuxinFDR <= 0.1)
NoAuxinFDR
which(gdata1$Gene == "TICRR")
gdata1[17172,]
p6 <- ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=abs(diff))) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score All Replicates Day9 vs pDNA - Absolute(Diff) > 0.5 & AuxinFDR <=0.1 - Batch Corrected") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1 & abs(diff) > 0.5), aes(label=Gene))
p6
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=diff)) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=abs(diff))) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=abs(diff))) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score All Replicates Day9 vs pDNA - Absolute(Diff) > 0.5 & AuxinFDR <=0.1 - Batch Corrected") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1 & abs(diff) > 0.5), aes(label=Gene))
# ggplot with nice labels and color scheme
ggplot(data=gdata1,aes(x=NoAuxin,y=Auxin,label=Gene,color=abs(diff))) +
geom_point() +
xlab("-Auxin") +
ylab("+Auxin") +
ggtitle("Control vs Treatment Beta Score with (Auxin - NoAuxin) Diff") +
scale_colour_gradient2(low = "#6a3d9a", mid = "#cab2d6", high = "#ff7f00") +
geom_text_repel(data=filter(gdata1, AuxinFDR<=0.1), aes(label=Gene))
gdata1 %>% filter(AuxinFDR <= 0.01 & diff > 0.5)
gdata1 %>% filter(NoAuxinFDR <= 0.01 & diff > 0.5)
Bottom10 <- gdata1[order(gdata1$diff, decreasing = F),]
Bottom10[1:10,]
Top10 <- gdata1[order(gdata1$diff, decreasing = T),]
Top10[1:10,]
## Top10 Negative Difference (Enhancers)
```{r}
Bottom10 <- gdata1[order(gdata1$diff, decreasing = F),]
Bottom10[1:10,]
```
Bottom10 <- gdata1[order(gdata1$diff, decreasing = F),]
Bottom10[1:10,]
setwd("~/Dropbox (OMRF)/Github/CRISPRScreenAnalysis/Vignettes/vignette4Data")
